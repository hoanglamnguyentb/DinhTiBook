{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, withCtx as _withCtx, createBlock as _createBlock, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode } from \"vue\";\nconst _hoisted_1 = {\n  style: {\n    \"min-height\": \"400px\"\n  }\n};\nconst _hoisted_2 = {\n  class: \"text-center mt-4\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_PageHeader = _resolveComponent(\"PageHeader\");\n  const _component_a_table = _resolveComponent(\"a-table\");\n  const _component_a_collapse_panel = _resolveComponent(\"a-collapse-panel\");\n  const _component_a_collapse = _resolveComponent(\"a-collapse\");\n  const _component_a_col = _resolveComponent(\"a-col\");\n  const _component_a_row = _resolveComponent(\"a-row\");\n  const _component_a_button = _resolveComponent(\"a-button\");\n  const _component_a_tab_pane = _resolveComponent(\"a-tab-pane\");\n  const _component_Pagination = _resolveComponent(\"Pagination\");\n  const _component_a_tabs = _resolveComponent(\"a-tabs\");\n  const _component_a_card = _resolveComponent(\"a-card\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_PageHeader, {\n    title: $data.title,\n    items: $data.items,\n    backRoute: $data.backRoute\n  }, null, 8 /* PROPS */, [\"title\", \"items\", \"backRoute\"]), _createVNode(_component_a_card, null, {\n    default: _withCtx(() => [_createVNode(_component_a_tabs, {\n      modelValue: $data.activeKey,\n      \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.activeKey = $event)\n    }, {\n      default: _withCtx(() => [_createVNode(_component_a_tab_pane, {\n        key: \"1\",\n        tab: \"Phân quyền vai trò\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_a_row, {\n          gutter: [12, 24]\n        }, {\n          default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.lstChucNang, (item, index) => {\n            return _openBlock(), _createBlock(_component_a_col, {\n              key: item.id,\n              span: 6\n            }, {\n              default: _withCtx(() => [_createVNode(_component_a_collapse, {\n                activeKey: $data.activeKeyColl,\n                \"onUpdate:activeKey\": _cache[0] || (_cache[0] = $event => $data.activeKeyColl = $event)\n              }, {\n                default: _withCtx(() => [(_openBlock(), _createBlock(_component_a_collapse_panel, {\n                  key: item.id,\n                  header: item.tenChucNang\n                }, {\n                  default: _withCtx(() => [_createVNode(_component_a_table, {\n                    pagination: false,\n                    columns: $data.columns,\n                    dataSource: item.thaoTacs,\n                    \"row-selection\": $data.createRowSelection(index),\n                    rowKey: \"id\"\n                  }, null, 8 /* PROPS */, [\"columns\", \"dataSource\", \"row-selection\"])]),\n                  _: 2 /* DYNAMIC */\n                }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"header\"]))]),\n                _: 2 /* DYNAMIC */\n              }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"activeKey\"])]),\n              _: 2 /* DYNAMIC */\n            }, 1024 /* DYNAMIC_SLOTS */);\n          }), 128 /* KEYED_FRAGMENT */))]),\n          _: 1 /* STABLE */\n        })]), _createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_a_button, {\n          onClick: $options.save\n        }, {\n          default: _withCtx(() => [_createTextVNode(\"Lưu lại\")]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"onClick\"])])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_a_tab_pane, {\n        key: \"2\",\n        tab: \"Người dùng\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_a_table, {\n          dataSource: _ctx.listUser,\n          columns: $data.userColumns\n        }, null, 8 /* PROPS */, [\"dataSource\", \"columns\"]), _createVNode(_component_Pagination, {\n          total: $data.optionPage.totalCount,\n          current: $data.optionPage.pageIndex,\n          \"per-page\": $data.optionPage.pageSize,\n          pageRange: $data.optionPage.totalCount,\n          onPageChanged: $options.handlePageChange\n        }, null, 8 /* PROPS */, [\"total\", \"current\", \"per-page\", \"pageRange\", \"onPageChanged\"])]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"modelValue\"])]),\n    _: 1 /* STABLE */\n  })], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["style","class","_createVNode","_component_PageHeader","title","$data","items","backRoute","_component_a_card","_component_a_tabs","activeKey","$event","_component_a_tab_pane","key","tab","_createElementVNode","_hoisted_1","_component_a_row","gutter","_createElementBlock","_Fragment","_renderList","lstChucNang","item","index","_createBlock","_component_a_col","id","span","_component_a_collapse","activeKeyColl","_component_a_collapse_panel","header","tenChucNang","_component_a_table","pagination","columns","dataSource","thaoTacs","createRowSelection","rowKey","_hoisted_2","_component_a_button","onClick","$options","save","_ctx","listUser","userColumns","_component_Pagination","total","optionPage","totalCount","current","pageIndex","pageSize","pageRange","onPageChanged","handlePageChange"],"sources":["D:\\HINET_1\\BacKan\\client\\src\\views\\dashboard\\QL_VaiTro\\PhanQuyenVaiTro.vue"],"sourcesContent":["<template>\r\n  <PageHeader :title=\"title\" :items=\"items\" :backRoute=\"backRoute\" />\r\n  <a-card>\r\n    <a-tabs v-model=\"activeKey\">\r\n      <a-tab-pane key=\"1\" tab=\"Phân quyền vai trò\">\r\n        <div style=\"min-height: 400px;\">\r\n          <a-row :gutter=\"[12,24]\">\r\n            <a-col v-for=\"(item,index) in lstChucNang\" :key=\"item.id\" :span=\"6\">\r\n              <a-collapse v-model:activeKey=\"activeKeyColl\">\r\n                <a-collapse-panel :key=\"item.id\" :header=\"item.tenChucNang\">\r\n                  <a-table :pagination=\"false\" :columns=\"columns\" :dataSource=\"item.thaoTacs\"\r\n                    :row-selection=\"createRowSelection(index)\" rowKey=\"id\">\r\n                  </a-table>\r\n                </a-collapse-panel>\r\n              </a-collapse>\r\n            </a-col>\r\n          </a-row>\r\n        </div>\r\n        <div class=\"text-center mt-4\">\r\n          <a-button @click=\"save\">Lưu lại</a-button>\r\n        </div>\r\n      </a-tab-pane>\r\n      <a-tab-pane key=\"2\" tab=\"Người dùng\">\r\n        <a-table :dataSource=\"listUser\" :columns=\"userColumns\">\r\n            \r\n        </a-table>\r\n        <Pagination\r\n            :total=\"optionPage.totalCount\"\r\n            :current=\"optionPage.pageIndex\"\r\n            :per-page=\"optionPage.pageSize\"\r\n            :pageRange=\"optionPage.totalCount\"\r\n            @page-changed=\"handlePageChange\"\r\n          />\r\n      </a-tab-pane>\r\n    </a-tabs>\r\n\r\n\r\n  </a-card>\r\n\r\n</template>\r\n\r\n<script>\r\nimport PageHeader from \"@/components/page-header\";\r\nimport APIService from \"@/helpers/ApiService\"\r\n\r\nexport default {\r\n  components: {\r\n    PageHeader\r\n  },\r\n async mounted() {\r\n    await this.getListChucNang()\r\n    this.getListRoleChucNang()\r\n    this.getListUserRole()\r\n  },\r\n  computed: {\r\n  },\r\n  data() {\r\n    return {\r\n      activeKeyColl: [],\r\n      backRoute: ' ',\r\n      activeKey: '1',\r\n      title: \"Phân quyền vai trò\",\r\n      createRowSelection(tableId) {\r\n        return {\r\n          selectedRowKeys: this.selectedRows[tableId] ? this.selectedRows[tableId] : [], // Sử dụng trạng thái đã lưu hoặc tạo mới\r\n          onChange: (selectedRowKeys) => {\r\n            this.selectedRows[tableId] = selectedRowKeys; // Cập nhật trạng thái row-select cho bảng hiện tại\r\n          },\r\n        };\r\n      },\r\n      lstChucNang: [],\r\n      items: [\r\n        {\r\n          text: \"Dashboard\",\r\n          href: \"/\",\r\n        },\r\n        {\r\n          text: \"Quản lí vai trò\",\r\n          href: \"/\",\r\n        },\r\n        {\r\n          text: \"Phân quyền vai trò\",\r\n          active: true,\r\n        },\r\n      ],\r\n      columns: [\r\n        { title: \"Tên thao tác\", dataIndex: \"tenThaoTac\", key: \"tenThaoTac\" },\r\n      ],\r\n      userColumns: [\r\n        { title: \"Họ tên\", dataIndex: \"fullName\", key: \"tenThaoTac\" },\r\n        { title: \"Tên đăng nhập\", dataIndex: \"userName\", key: \"tenThaoTac\" },\r\n        { title: \"Email\", dataIndex: \"email\", key: \"tenThaoTac\" },\r\n        { title: \"Điện thoại\", dataIndex: \"phoneNumber\", key: \"tenThaoTac\" },\r\n      ],\r\n      optionPage: {\r\n        pageIndex: 1,\r\n        pageSize: 10,\r\n        totalCount: 0,\r\n      },\r\n      selectedRowIds: [],\r\n      selectedRows: [],\r\n    };\r\n  },\r\n  methods: {\r\n    async getListChucNang() {\r\n      var result = (await APIService.get(`/ChucNang/GetListChucNang?pageIndex=1&pageSize=-1`)).data;\r\n      this.lstChucNang = result.data.items;\r\n    },\r\n    async getListUserRole() {\r\n      var searchParam = {\r\n        pageIndex: this.optionPage.pageIndex,\r\n        pageSize: this.optionPage.pageSize,\r\n        roleId: this.$route.params.roleId\r\n      };\r\n      var urlQuery = new URLSearchParams(searchParam).toString();\r\n      var res = (await APIService.get(`/AppUserRole/getUserByRole?${urlQuery}`)).data;\r\n      this.listUser = res.data.items;\r\n      this.optionPage.pageIndex = res.pageIndex;\r\n      this.optionPage.pageSize = res.pageSize;\r\n      this.optionPage.totalCount = res.totalCount;\r\n    },\r\n    async getListRoleChucNang() {\r\n      var result = (await APIService.get(`/RoleThaoTac/GetListRoleThaoTacByRoleId/${this.$route.params.roleId}?pageIndex=1&pageSize=-1`)).data;\r\n      this.lstChucNang.forEach((elm, index) => {\r\n        var lstThaoTac = elm.thaoTacs.map(x => x.id)\r\n        this.selectedRows[index] = result.data.items.filter(x=> lstThaoTac.includes(x.thaoTacId)).map(x => x.thaoTacId)\r\n      });\r\n    },\r\n    handlePageChange(page) {\r\n      this.optionPage.pageIndex = page;\r\n      this.loadData(this.optionPage.pageIndex, this.optionPage.pageSize);\r\n    },\r\n    async save() {\r\n      const listThaoTacId = this.selectedRows.flatMap(subArray => subArray);\r\n      await APIService.post(`/RoleThaoTac/CreateRoleThaoTac/${this.$route.params.roleId}`,listThaoTacId)\r\n      this.$message.success('Thành công')\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style></style>\r\n"],"mappings":";;EAKaA,KAA0B,EAA1B;IAAA;EAAA;AAA0B;;EAa1BC,KAAK,EAAC;AAAkB;;;;;;;;;;;;;6DAjBnCC,YAAA,CAAmEC,qBAAA;IAAtDC,KAAK,EAAEC,KAAA,CAAAD,KAAK;IAAGE,KAAK,EAAED,KAAA,CAAAC,KAAK;IAAGC,SAAS,EAAEF,KAAA,CAAAE;4DACtDL,YAAA,CAmCSM,iBAAA;sBAlCP,MA+BS,CA/BTN,YAAA,CA+BSO,iBAAA;kBA/BQJ,KAAA,CAAAK,SAAS;iEAATL,KAAA,CAAAK,SAAS,GAAAC,MAAA;;wBACxB,MAiBa,CAjBbT,YAAA,CAiBaU,qBAAA;QAjBDC,GAAG,EAAC,GAAG;QAACC,GAAG,EAAC;;0BACtB,MAYM,CAZNC,mBAAA,CAYM,OAZNC,UAYM,GAXJd,YAAA,CAUQe,gBAAA;UAVAC,MAAM,EAAE;QAAO;4BACd,MAAmC,E,kBAA1CC,mBAAA,CAQQC,SAAA,QAAAC,WAAA,CARsBhB,KAAA,CAAAiB,WAAW,GAA1BC,IAAI,EAACC,KAAK;iCAAzBC,YAAA,CAQQC,gBAAA;cARoCb,GAAG,EAAEU,IAAI,CAACI,EAAE;cAAGC,IAAI,EAAE;;gCAC/D,MAMa,CANb1B,YAAA,CAMa2B,qBAAA;gBANOnB,SAAS,EAAEL,KAAA,CAAAyB,aAAa;0EAAbzB,KAAA,CAAAyB,aAAa,GAAAnB,MAAA;;kCAC1C,MAImB,E,cAJnBc,YAAA,CAImBM,2BAAA;kBAJAlB,GAAG,EAAEU,IAAI,CAACI,EAAE;kBAAGK,MAAM,EAAET,IAAI,CAACU;;oCAC7C,MAEU,CAFV/B,YAAA,CAEUgC,kBAAA;oBAFAC,UAAU,EAAE,KAAK;oBAAGC,OAAO,EAAE/B,KAAA,CAAA+B,OAAO;oBAAGC,UAAU,EAAEd,IAAI,CAACe,QAAQ;oBACvE,eAAa,EAAEjC,KAAA,CAAAkC,kBAAkB,CAACf,KAAK;oBAAGgB,MAAM,EAAC;;;;;;;;;;cAO9DzB,mBAAA,CAEM,OAFN0B,UAEM,GADJvC,YAAA,CAA0CwC,mBAAA;UAA/BC,OAAK,EAAEC,QAAA,CAAAC;QAAI;4BAAE,MAAO,C,iBAAP,SAAO,E;;;;UAGnC3C,YAAA,CAWaU,qBAAA;QAXDC,GAAG,EAAC,GAAG;QAACC,GAAG,EAAC;;0BACtB,MAEU,CAFVZ,YAAA,CAEUgC,kBAAA;UAFAG,UAAU,EAAES,IAAA,CAAAC,QAAQ;UAAGX,OAAO,EAAE/B,KAAA,CAAA2C;4DAG1C9C,YAAA,CAMI+C,qBAAA;UALCC,KAAK,EAAE7C,KAAA,CAAA8C,UAAU,CAACC,UAAU;UAC5BC,OAAO,EAAEhD,KAAA,CAAA8C,UAAU,CAACG,SAAS;UAC7B,UAAQ,EAAEjD,KAAA,CAAA8C,UAAU,CAACI,QAAQ;UAC7BC,SAAS,EAAEnD,KAAA,CAAA8C,UAAU,CAACC,UAAU;UAChCK,aAAY,EAAEb,QAAA,CAAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}