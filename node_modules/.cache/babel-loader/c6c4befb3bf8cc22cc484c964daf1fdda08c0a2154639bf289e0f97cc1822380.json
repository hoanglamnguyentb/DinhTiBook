{"ast":null,"code":"import PageHeader from \"@/components/page-header\";\nimport APIService from \"@/helpers/ApiService\";\nexport default {\n  components: {\n    PageHeader\n  },\n  async mounted() {\n    await this.getListChucNang();\n    this.getListRoleChucNang();\n    this.getListUserRole();\n  },\n  computed: {},\n  data() {\n    return {\n      activeKeyColl: [],\n      backRoute: ' ',\n      activeKey: '1',\n      title: \"Phân quyền vai trò\",\n      createRowSelection(tableId) {\n        return {\n          selectedRowKeys: this.selectedRows[tableId] ? this.selectedRows[tableId] : [],\n          // Sử dụng trạng thái đã lưu hoặc tạo mới\n          onChange: selectedRowKeys => {\n            this.selectedRows[tableId] = selectedRowKeys; // Cập nhật trạng thái row-select cho bảng hiện tại\n          }\n        };\n      },\n      lstChucNang: [],\n      items: [{\n        text: \"Dashboard\",\n        href: \"/\"\n      }, {\n        text: \"Quản lí vai trò\",\n        href: \"/\"\n      }, {\n        text: \"Phân quyền vai trò\",\n        active: true\n      }],\n      columns: [{\n        title: \"Tên thao tác\",\n        dataIndex: \"tenThaoTac\",\n        key: \"tenThaoTac\"\n      }],\n      userColumns: [{\n        title: \"Họ tên\",\n        dataIndex: \"fullName\",\n        key: \"tenThaoTac\"\n      }, {\n        title: \"Tên đăng nhập\",\n        dataIndex: \"userName\",\n        key: \"tenThaoTac\"\n      }, {\n        title: \"Email\",\n        dataIndex: \"email\",\n        key: \"tenThaoTac\"\n      }, {\n        title: \"Điện thoại\",\n        dataIndex: \"phoneNumber\",\n        key: \"tenThaoTac\"\n      }],\n      optionPage: {\n        pageIndex: 1,\n        pageSize: 10,\n        totalCount: 0\n      },\n      selectedRowIds: [],\n      selectedRows: []\n    };\n  },\n  methods: {\n    async getListChucNang() {\n      var result = (await APIService.get(`/ChucNang/GetListChucNang?pageIndex=1&pageSize=-1`)).data;\n      this.lstChucNang = result.data.items;\n    },\n    async getListUserRole() {\n      var searchParam = {\n        pageIndex: this.optionPage.pageIndex,\n        pageSize: this.optionPage.pageSize,\n        roleId: this.$route.params.roleId\n      };\n      var urlQuery = new URLSearchParams(searchParam).toString();\n      var res = (await APIService.get(`/AppUserRole/getUserByRole?${urlQuery}`)).data;\n      this.listUser = res.data.items;\n      this.optionPage.pageIndex = res.pageIndex;\n      this.optionPage.pageSize = res.pageSize;\n      this.optionPage.totalCount = res.totalCount;\n    },\n    async getListRoleChucNang() {\n      var result = (await APIService.get(`/RoleThaoTac/GetListRoleThaoTacByRoleId/${this.$route.params.roleId}?pageIndex=1&pageSize=-1`)).data;\n      this.lstChucNang.forEach((elm, index) => {\n        var lstThaoTac = elm.thaoTacs.map(x => x.id);\n        this.selectedRows[index] = result.data.items.filter(x => lstThaoTac.includes(x.thaoTacId)).map(x => x.thaoTacId);\n      });\n    },\n    handlePageChange(page) {\n      this.optionPage.pageIndex = page;\n      this.loadData(this.optionPage.pageIndex, this.optionPage.pageSize);\n    },\n    async save() {\n      const listThaoTacId = this.selectedRows.flatMap(subArray => subArray);\n      await APIService.post(`/RoleThaoTac/CreateRoleThaoTac/${this.$route.params.roleId}`, listThaoTacId);\n      this.$message.success('Thành công');\n    }\n  }\n};","map":{"version":3,"names":["PageHeader","APIService","components","mounted","getListChucNang","getListRoleChucNang","getListUserRole","computed","data","activeKeyColl","backRoute","activeKey","title","createRowSelection","tableId","selectedRowKeys","selectedRows","onChange","lstChucNang","items","text","href","active","columns","dataIndex","key","userColumns","optionPage","pageIndex","pageSize","totalCount","selectedRowIds","methods","result","get","searchParam","roleId","$route","params","urlQuery","URLSearchParams","toString","res","listUser","forEach","elm","index","lstThaoTac","thaoTacs","map","x","id","filter","includes","thaoTacId","handlePageChange","page","loadData","save","listThaoTacId","flatMap","subArray","post","$message","success"],"sources":["D:\\DA\\DoAnClient\\client\\src\\views\\dashboard\\QL_VaiTro\\PhanQuyenVaiTro.vue"],"sourcesContent":["<template>\r\n  <PageHeader :title=\"title\" :items=\"items\" :backRoute=\"backRoute\" />\r\n  <a-card>\r\n    <a-tabs v-model=\"activeKey\">\r\n      <a-tab-pane key=\"1\" tab=\"Phân quyền vai trò\">\r\n        <div style=\"min-height: 400px;\">\r\n          <a-row :gutter=\"[12,24]\">\r\n            <a-col v-for=\"(item,index) in lstChucNang\" :key=\"item.id\" :span=\"6\">\r\n              <a-collapse v-model:activeKey=\"activeKeyColl\">\r\n                <a-collapse-panel :key=\"item.id\" :header=\"item.tenChucNang\">\r\n                  <a-table :pagination=\"false\" :columns=\"columns\" :dataSource=\"item.thaoTacs\"\r\n                    :row-selection=\"createRowSelection(index)\" rowKey=\"id\">\r\n                  </a-table>\r\n                </a-collapse-panel>\r\n              </a-collapse>\r\n            </a-col>\r\n          </a-row>\r\n        </div>\r\n        <div class=\"text-center mt-4\">\r\n          <a-button @click=\"save\">Lưu lại</a-button>\r\n        </div>\r\n      </a-tab-pane>\r\n      <a-tab-pane key=\"2\" tab=\"Người dùng\">\r\n        <a-table :dataSource=\"listUser\" :columns=\"userColumns\">\r\n            \r\n        </a-table>\r\n        <Pagination\r\n            :total=\"optionPage.totalCount\"\r\n            :current=\"optionPage.pageIndex\"\r\n            :per-page=\"optionPage.pageSize\"\r\n            :pageRange=\"optionPage.totalCount\"\r\n            @page-changed=\"handlePageChange\"\r\n          />\r\n      </a-tab-pane>\r\n    </a-tabs>\r\n\r\n\r\n  </a-card>\r\n\r\n</template>\r\n\r\n<script>\r\nimport PageHeader from \"@/components/page-header\";\r\nimport APIService from \"@/helpers/ApiService\"\r\n\r\nexport default {\r\n  components: {\r\n    PageHeader\r\n  },\r\n async mounted() {\r\n    await this.getListChucNang()\r\n    this.getListRoleChucNang()\r\n    this.getListUserRole()\r\n  },\r\n  computed: {\r\n  },\r\n  data() {\r\n    return {\r\n      activeKeyColl: [],\r\n      backRoute: ' ',\r\n      activeKey: '1',\r\n      title: \"Phân quyền vai trò\",\r\n      createRowSelection(tableId) {\r\n        return {\r\n          selectedRowKeys: this.selectedRows[tableId] ? this.selectedRows[tableId] : [], // Sử dụng trạng thái đã lưu hoặc tạo mới\r\n          onChange: (selectedRowKeys) => {\r\n            this.selectedRows[tableId] = selectedRowKeys; // Cập nhật trạng thái row-select cho bảng hiện tại\r\n          },\r\n        };\r\n      },\r\n      lstChucNang: [],\r\n      items: [\r\n        {\r\n          text: \"Dashboard\",\r\n          href: \"/\",\r\n        },\r\n        {\r\n          text: \"Quản lí vai trò\",\r\n          href: \"/\",\r\n        },\r\n        {\r\n          text: \"Phân quyền vai trò\",\r\n          active: true,\r\n        },\r\n      ],\r\n      columns: [\r\n        { title: \"Tên thao tác\", dataIndex: \"tenThaoTac\", key: \"tenThaoTac\" },\r\n      ],\r\n      userColumns: [\r\n        { title: \"Họ tên\", dataIndex: \"fullName\", key: \"tenThaoTac\" },\r\n        { title: \"Tên đăng nhập\", dataIndex: \"userName\", key: \"tenThaoTac\" },\r\n        { title: \"Email\", dataIndex: \"email\", key: \"tenThaoTac\" },\r\n        { title: \"Điện thoại\", dataIndex: \"phoneNumber\", key: \"tenThaoTac\" },\r\n      ],\r\n      optionPage: {\r\n        pageIndex: 1,\r\n        pageSize: 10,\r\n        totalCount: 0,\r\n      },\r\n      selectedRowIds: [],\r\n      selectedRows: [],\r\n    };\r\n  },\r\n  methods: {\r\n    async getListChucNang() {\r\n      var result = (await APIService.get(`/ChucNang/GetListChucNang?pageIndex=1&pageSize=-1`)).data;\r\n      this.lstChucNang = result.data.items;\r\n    },\r\n    async getListUserRole() {\r\n      var searchParam = {\r\n        pageIndex: this.optionPage.pageIndex,\r\n        pageSize: this.optionPage.pageSize,\r\n        roleId: this.$route.params.roleId\r\n      };\r\n      var urlQuery = new URLSearchParams(searchParam).toString();\r\n      var res = (await APIService.get(`/AppUserRole/getUserByRole?${urlQuery}`)).data;\r\n      this.listUser = res.data.items;\r\n      this.optionPage.pageIndex = res.pageIndex;\r\n      this.optionPage.pageSize = res.pageSize;\r\n      this.optionPage.totalCount = res.totalCount;\r\n    },\r\n    async getListRoleChucNang() {\r\n      var result = (await APIService.get(`/RoleThaoTac/GetListRoleThaoTacByRoleId/${this.$route.params.roleId}?pageIndex=1&pageSize=-1`)).data;\r\n      this.lstChucNang.forEach((elm, index) => {\r\n        var lstThaoTac = elm.thaoTacs.map(x => x.id)\r\n        this.selectedRows[index] = result.data.items.filter(x=> lstThaoTac.includes(x.thaoTacId)).map(x => x.thaoTacId)\r\n      });\r\n    },\r\n    handlePageChange(page) {\r\n      this.optionPage.pageIndex = page;\r\n      this.loadData(this.optionPage.pageIndex, this.optionPage.pageSize);\r\n    },\r\n    async save() {\r\n      const listThaoTacId = this.selectedRows.flatMap(subArray => subArray);\r\n      await APIService.post(`/RoleThaoTac/CreateRoleThaoTac/${this.$route.params.roleId}`,listThaoTacId)\r\n      this.$message.success('Thành công')\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style></style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}